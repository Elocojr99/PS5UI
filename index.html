<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Display with Animations</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/comfy.js@1.1.16/dist/comfy.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000; /* Adjusted for better visibility */
            color: #fff; /* Adjusted for better visibility */
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        #chat {
            display: flex;
            flex-direction: column;
            padding: 10px;
            max-width: 400px;
            margin: 0 auto;
        }
        .message {
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #111; /* Adjusted for better contrast */
            border-radius: 15px;
            box-sizing: border-box;
            animation: fadeInRight 0.5s forwards;
        }
        .username {
            color: #888;
            font-size: 0.8em;
            margin-bottom: 5px;
        }
        .text {
            color: #fff;
            font-size: 1em;
        }
        img.emote {
            height: 28px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="chat">
        <!-- The message will be added here by JavaScript -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            ComfyJS.Init("Yizfe");
            ComfyJS.onChat = (user, message, flags, self, extra) => {
                if(self) return; // Don't display messages from the bot itself
                const processedMessage = processMessageWithEmotes(message, extra.emotes);
                addChatMessage(user, processedMessage);
            };

            function addChatMessage(username, message) {
                const chatDiv = document.getElementById('chat');
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');

                const usernameDiv = document.createElement('div');
                usernameDiv.classList.add('username');
                usernameDiv.textContent = username;

                const textDiv = document.createElement('div');
                textDiv.classList.add('text');
                textDiv.innerHTML = message; // Use innerHTML to render the <img> tags

                messageDiv.appendChild(usernameDiv);
                messageDiv.appendChild(textDiv);
                chatDiv.appendChild(messageDiv);

                setTimeout(() => {
                    messageDiv.style.animation = 'fadeOutRight 0.5s forwards';
                    setTimeout(() => messageDiv.remove(), 500);
                }, 10000); // Messages fade out after 10 seconds
            }

            function processMessageWithEmotes(message, emotes) {
                if (!emotes) return message;
                Object.keys(emotes).forEach(id => {
                    const emote = emotes[id];
                    for (let i = 0; i < emote.length; i++) {
                        const [start, end] = emote[i].split('-');
                        const length = end - start;
                        const emoteCode = message.substr(start, length + 1);
                        const emoteImg = `<img class="emote" src="https://static-cdn.jtvnw.net/emoticons/v1/${id}/1.0" alt="${emoteCode}">`;
                        message = message.slice(0, start + i * (emoteImg.length - length - 1)) + emoteImg + message.slice(start + length + 1 + i * (emoteImg.length - length - 1));
                    }
                });
                return message;
            }
        });
    </script>
</body>
</html>
